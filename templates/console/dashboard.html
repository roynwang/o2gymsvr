 <!DOCTYPE html>
{% load staticfiles %}
 <html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">
    <meta http-equiv=”X-UA-Compatible” content=”IE=EmulateIE9”>
    <meta http-equiv=”X-UA-Compatible” content=”IE=9”>
	<link rel="shortcut icon" href="{% static "images/favicon.ico" %}">
    <title>氧气健身</title>
    <!--Core CSS -->
	<link href="{% static "bs3/css/bootstrap.min.css" %}" rel="stylesheet">
	<link href="{% static "js/jquery-ui/jquery-ui-1.10.1.custom.min.css" %}" rel="stylesheet">
	<link href="{% static "consolecss/bootstrap-reset.css" %}" rel="stylesheet">
	<link href="{% static "font-awesome/css/font-awesome.css" %}" rel="stylesheet">
	<link href="{% static "consolecss/ng-table.min.css" %}" rel="stylesheet"/>
	<link href="{% static "css/angular-datepicker.min.css" %}" rel="stylesheet"/>
	<link href="//cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet">

	<link href="//cdn.bootcss.com/ladda-bootstrap/0.9.4/ladda-themeless.min.css" rel="stylesheet">

	<!--
	<link href="{% static "js/jvector-map/jquery-jvectormap-1.2.2.css" %}" rel="stylesheet">
	<link href="{% static "consolecss/clndr.css" %}" rel="stylesheet">
	<link href="{% static "js/css3clock/css/style.css" %}" rel="stylesheet">
	<link rel="stylesheet" href="{% static "js/morris-chart/morris.css"%}" >
	-->
	<link href="{% static "consolecss/style.css" %}" rel="stylesheet">
	<link href="{% static "consolecss/o2custom.css" %}" rel="stylesheet">
	<link href="{% static "consolecss/style-responsive.css" %}" rel="stylesheet">
	<link href="//cdn.bootcss.com/bootstrap-switch/3.3.2/css/bootstrap3/bootstrap-switch.min.css">
	<link href="//cdn.bootcss.com/angular-chart.js/0.8.8/angular-chart.min.css" rel="stylesheet" rel="stylesheet">


    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]>
    <script src="js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
	<!--<link href="{% static "consolecss/bootstrap-datepicker/css/datepicker.css" %}"
	rel="stylesheet"/>-->

</head>
 </body>
<section id="container">
<!--header start-->
<header class="header fixed-top clearfix">
<!--logo start-->
<div class="brand">
    <a href="index.html" class="logo">
        <img src="/static/images/logo.png" alt="" style="width:40px;display:inline-block">
    </a>
    <div class="sidebar-toggle-box">
        <div class="fa fa-bars"></div>
    </div>
</div>
<!--logo end-->
<div class="nav notify-row" id="top_menu">
    
</div>
<div class="top-nav clearfix">
	<ul class="nav pull-left top-menu admin-show">
        <!-- user login dropdown start-->
        <li class="dropdown" style="margin-top: -1px;">
            <a data-toggle="dropdown" class="dropdown-toggle"
				style="line-height: 33px; padding-left: 8px; background-color: #1FB5AD !important; padding-right: 14px !important;" href="#">
                <span class="username" id="gym-name" style="color:#fff;
					margin-left:10px;font-size:14px"></span>
				<b class="caret" style="border-bottom-color: white;border-top-color: white;"></b>
            </a>
            <ul class="dropdown-menu extended logout" id="profile-menu" style="right: auto; width: 250px !important">
           <!--     <li><a href="#"><i class=" fa fa-suitcase"></i>Profile</a></li>
                <li><a href="#"><i class="fa fa-cog"></i> Settings</a></li>
				-->
                <li><a href="#/newgym"><i class="fa fa-key"></i>添加健身房</a></li>
            </ul>
        </li>
        <li id="header_notification_bar" class="dropdown" style="margin-top: 5px;">
            <a data-toggle="dropdown" class="dropdown-toggle" href="#">

                <i class="fa fa-bell-o"></i>
                <span class="badge bg-warning" id="incomplete-count">3</span>
            </a>
            <ul id="incomplete" class="dropdown-menu extended notification">
                <li>
                    <p>未完成课程</p>
                </li>
                <li>
                    <div class="alert alert-success clearfix">
                        <span class="alert-icon"><i class="fa fa-bolt"></i></span>
                        <div class="noti-info">
                            <a href="#"> Server #3 overloaded.</a>
                        </div>
                    </div>
                </li>
            </ul>
        </li>
	    <li class="dropdown" style="margin-top: 5px;">
            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                <i class="fa fa-gift" style="font-size: 22px;"></i>
                <span class="badge bg-success" id="birthdays-count">3</span>
            </a>
            <ul id="birthdays" class="dropdown-menu extended notification">
                <li>
                    <p>生日提醒</p>
                </li>
                <li>
                    <div class="alert alert-success clearfix">
                        <span class="alert-icon"><i class="fa fa-bolt"></i></span>
                        <div class="noti-info">
                            <a href="#"> Server #3 overloaded.</a>
                        </div>
                    </div>
                </li>
            </ul>
        </li>
    </ul>
    <!--search & user info start-->

    <ul class="nav pull-right top-menu">
        <li>
            <input id="customer-search" type="text" class="form-control search" placeholder="输入用户姓名/首字母">
        </li>
        <!-- user login dropdown start-->
        <li class="dropdown">
            <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                <img alt="" src="/static/images/favicon.ico" id="useravatar">
                <span class="username" id="username">载入中</span>
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu extended logout">
                <li><a id="logout"><i class="fa fa-key"></i>注销</a></li>
            </ul>
        </li>

    </ul>
    <!--search & user info end-->
</div>
</header>
<!--header end-->
<!--sidebar start-->
<aside>
    <div id="sidebar" class="nav-collapse">
        <!-- sidebar menu start-->
        <div class="leftside-navigation">
            <ul class="sidebar-menu" id="nav-accordion">
                <li>
                    <a  class="active" href="#/">
                        <i class="fa fa-bars"></i>
                        <span>前台</span>
                    </a>
                </li>
               <li>
                    <a href="#/coaches">
                        <i class="fa fa-th"></i>
                        <span>教练管理</span>
                    </a>
                </li>
	            <li>
                    <a href="#customers">
                        <i class="fa fa-group"></i>
                        <span>客户信息</span>
                    </a>
                </li>
	            <li class="admin-show">
                    <a href="#sale" >
                        <i class="fa fa-bar-chart-o"></i>
                        <span>销售统计</span>
                    </a>
                </li>
	            <li class="sub-menu admin-show">
                    <a href="javascript:;">
                        <i class="fa  fa-credit-card"></i>
                        <span>工资结算</span>
                    </a>
                    <ul class="sub">
                        <li><a href="#salarysummary">工资结算</a></li>
                        <li><a href="#salarysetting">工资设置</a></li>
					</ul>
                </li>
   <!-- 
                <li class="sub-menu">
                    <a href="javascript:;">
                        <i class="fa fa-laptop"></i>
                        <span>付费与支持</span>
                    </a>
                    <ul class="sub">
                        <li><a href="boxed_page.html">技术支持</a></li>
                        <li><a href="horizontal_menu.html">付费信息</a></li>
                        <li><a href="#feedback">意见和建议</a></li>
                    </ul>
                </li>
	-->
            </ul>            </div>
        <!-- sidebar menu end-->
    </div>
</aside>
<!--sidebar end-->
<section id="main-content">
<section class="wrapper" ng-app="JobApp">
	 <div ui-view> 载入中... ...</div>
</section>
</section>
	 <script src="//cdn.bootcss.com/angular.js/1.4.7/angular.min.js"></script>
     <script src="//cdn.bootcss.com/angular-ui-router/0.2.15/angular-ui-router.min.js"></script>
	 <script src="//cdn.bootcss.com/angular-ui-bootstrap/0.14.3/ui-bootstrap.min.js"></script>
	 <script src="//cdn.bootcss.com/angular-ui-bootstrap/0.14.3/ui-bootstrap-tpls.min.js"></script>
	 <script src="//cdn.bootcss.com/angular-i18n/1.5.0-beta.1/angular-locale_zh-cn.min.js"></script>
	<script src="//cdn.bootcss.com/Chart.js/1.0.2/Chart.min.js"></script>
	<script src="//cdn.bootcss.com/angular-chart.js/0.8.8/angular-chart.min.js"></script>


<script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
<script src="/static/js/jquery-ui/jquery-ui-1.10.1.custom.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="/static/js/jquery.scrollTo.min.js"></script>
<script src="/static/js/jquery.dcjqaccordion.2.7.js"></script>
<script src="/static/js/jquery.nicescroll.js"></script>
<script src="/static/js/jquery.autocomplete.min.js"></script>

<!--
<script src="/static/bs3/js/bootstrap.min.js"></script>
<script src="/static/js/jQuery-slimScroll-1.3.0/jquery.slimscroll.js"></script>
<script src="/static/js/skycons/skycons.js"></script>
<script src="/static/js/jquery.scrollTo/jquery.scrollTo.js"></script>
<script src="/static/js/calendar/clndr.js"></script>
<script src="/static/js/calendar/moment-2.2.1.js"></script>
<script src="/static/js/evnt.calendar.init.js"></script>
<script src="/static/js/jvector-map/jquery-jvectormap-1.2.2.min.js"></script>
<script src="/static/js/jvector-map/jquery-jvectormap-us-lcc-en.js"></script>
<script src="/static/js/gauge/gauge.js"></script>

<script src="/static/js/css3clock/js/css3clock.js"></script>
<script src="/static/js/easypiechart/jquery.easypiechart.js"></script>
<script src="/static/js/sparkline/jquery.sparkline.js"></script>
<script src="/static/js/morris-chart/morris.js"></script>
<script src="/static/js/morris-chart/raphael-min.js"></script>
-->
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="js/flot-chart/excanvas.min.js"></script><![endif]-->
<!--jQuery Flot Chart

<script src="/static/js/flot-chart/jquery.flot.js"></script>
<script src="/static/js/flot-chart/jquery.flot.tooltip.min.js"></script>
<script src="/static/js/flot-chart/jquery.flot.resize.js"></script>
<script src="/static/js/flot-chart/jquery.flot.pie.resize.js"></script>
<script src="/static/js/flot-chart/jquery.flot.animator.min.js"></script>
<script src="/static/js/flot-chart/jquery.flot.growraf.js"></script>
<script src="/static/js/dashboard.js"></script>
-->


<script src="//cdn.bootcss.com/ladda-bootstrap/0.9.4/spin.min.js"></script>
<script src="//cdn.bootcss.com/ladda-bootstrap/0.9.4/ladda.min.js"></script>

<script src="//cdn.bootcss.com/bootstrap-switch/3.3.2/js/bootstrap-switch.min.js"></script>
<script src="//cdn.bootcss.com/restangular/1.5.1/restangular.min.js"></script>
<script src="//cdn.bootcss.com/jquery-easing/1.3/jquery.easing.min.js"></script>
<script src="//cdn.bootcss.com/underscore.js/1.8.3/underscore-min.js"></script>
<script src="//cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.js"></script>
<script src="/static/js/SweetAlert.min.js" ></script>
<script src="/static/js/ng-table.min.js" ></script>
<script src="/static/js/jquery.customSelect.min.js" ></script>
<!--common script init for all pages-->
<script src="/static/js/scripts.js"></script>
<script src="/static/js/angular-datepicker.min.js"></script>
<!--script for this page-->
<script src="/static/js/jwt-decode.min.js" ></script>
<script src="/static/js/ngSlimscroll.min.js" ></script>
<script src="{% static "js/jquery.cookie.js" %}" ></script>
<script src="/static/js/angular-ladda.min.js" ></script>
<script>
	//load user info by token
	var USER = null
	var $gymlist = []
	$(".admin-show").hide()
	var incompleteid = false
	function getusrauth(){
		console.log($.cookie())
		if($.cookie("token")){
			console.log($.cookie("token"))
			return decoded = jwt_decode($.cookie("token"));
		} else {
			window.location = "/console/login/"
		}
	}
	function refreshuser(authinfo,gymid){
		$.get("/api/" + authinfo.username + "/", function(data){
			USER = data
			$.cookie("user", USER.name, {path:"/"})
			if(gymid == undefined){
				$.cookie("gym", USER.gym_id[0], {path:"/"})
			}else {
				$.cookie("gym", gymid, {path:"/"})
			}
			$("#username").html(data.displayname)
			$("#useravatar").attr("src", data.avatar)
			if(data.role == "admin"){
				$(".admin-show").show()
			}
			$gymlist = data.corps_list
			refreshcorner()
			getincomplete()
			if(incompleteid){
				clearInterval(incompleteid)
			}
			incompleteid = setInterval(getincomplete,1800000)
		}).fail(function(resp){
			
		})
	}
	function refreshcorner(needrefresh){
		var update = function(){
			var ori = ""
			$.each($gymlist,function(i,item){
				if(item.k ==  $.cookie("gym")){
					$("#gym-name").html(item.v)
					ori += '<li><a style="color:#1fb5ac;font-size:14px" href="#/gym/'+ item.k + '"><i class="fa fa-check-circle-o"></i><strong>' + item.v + '</strong></a></li>'
				} else{
					ori += '<li><a href="#/gym/'+ item.k + '"><i class="fa fa-circle-o"></i>' + item.v + '</a></li>'
				}
			})
			ori += '<li><a href="#/newgym"><i class="fa fa-plus-circle"></i>添加分店</a></li>'
			$("#profile-menu").html(ori)
		}
		if(needrefresh){
			refreshuser(getusrauth())
		} else {
			update()
		}
	}
	function getincomplete(){
        var itemtemplate = '<li><div class="alert alert-success clearfix"><span class="alert-icon"><i class="fa fa-bolt"></i></span><div class="noti-info"><a href="#">__</a></div></div></li>'
		$("#incomplete").html("")
		$("#incomplete").append("<li><p>未完成课程</p></li>")
		$.get("/api/g/" + $.cookie("gym") + "/incomplete/", function(data){
				$("#incomplete-count").html(data.length)
				_.each(data, function(item){
					$("#incomplete").append(itemtemplate.replace(/__/,'<a href="#/order/' + item.coachprofile.name + "/" + item.order + '">' + item.date + "&nbsp;&nbsp;&nbsp;" + item.customerprofile.displayname + "</a>"))
				})
		})
	}
	function getbirthdays(data){
        var itemtemplate = '<li><div class="alert alert-success clearfix" style="padding-top:0"><div class="noti-info"><a href="#">__</a></div></div></li>'
		$("#birthdays").html("")
		$("#birthdays").append("<li><p>生日提醒</p></li>")

		var filtered = _.filter(data,{birthday: new Date().Format("yyyy-MM-dd")})

		$("#birthdays-count").html(filtered.length)
		_.each(filtered, function(item){
			if(item.birthday){
				$("#birthdays").append(itemtemplate.replace(/__/,'<a>' + item.displayname + "</a>"))
			}
		})
	}

	$(function(){
		refreshuser(getusrauth())
		$("#logout").click(function(){
			$.removeCookie("user")
			$.removeCookie("gym")
			window.location = "/console/login/"
		})
	})

</script>

<script src="/static/js/console/app.js"></script>
 </body>


 </html>
